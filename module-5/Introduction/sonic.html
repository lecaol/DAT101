<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <title>Sonic Example</title>
    <style>
      .prevent-select {
        -webkit-user-select: none; /* Safari */
        -ms-user-select: none; /* IE 10 and IE 11 */
        user-select: none; /* Standard syntax */
      }
    </style>
    <!-- Import map: map the bare specifier "three" to the local module build. -->
    <script type="importmap">
      {
        "imports": {
          "libSprite": "../../common/script/libSprite.mjs",
          "lib2d": "../../common/script/lib2d.mjs"
        }
      }
    </script>
  </head>
  <body class="prevent-select">
    <canvas id="cvs" style="background-color: antiquewhite" width="1024" height="512"></canvas>
  </body>
  <script type="module" defer> //Betyr at scriptet lastes etter html er lastet
    //Import libraries
    import { TSpriteCanvas, TSprite } from "libSprite";

  // prettier-ignore
  const SpriteInfoList = {
    sonic1: { x: 0, y:   0, width: 102, height: 125, count: 6},
    sonic2: { x: 0, y: 125, width: 102, height: 125, count: 9},
    sonic3: { x: 0, y: 250, width: 102, height: 125, count: 9},
    sonic4: { x: 0, y: 375, width: 102, height:  75, count: 7},
    sonic5: { x: 0, y: 450, width: 100, height: 130, count: 5},
    sonic6: { x: 0, y: 575, width: 102, height: 125, count: 3},
    sonic7: { x: 0, y: 700, width: 102, height: 125, count: 2},
    sonic8: { x: 0, y: 825, width: 102, height: 125, count: 2},
    sonic9: { x: 0, y: 950, width: 102, height: 125, count: 4}
  }

    //Global variables
    const cvs = document.getElementById("cvs");
    const ctx = cvs.getContext("2d");
    const spcvs = new TSpriteCanvas(cvs); //spcvs: forkortelse for sprite canvas
    const hero = new TSprite(spcvs, SpriteInfoList.sonic2, 0, 100); //spcvs parameter forteller at sprite skal tegnes i dette canvaset + henter sprite info fra listen + koordinater hvor sonic skal dukke opp
    const hero2 = new TSprite(spcvs, SpriteInfoList.sonic4, 0, 250); //En annen sprite for å vise at flere sprites kan brukes samtidig
    const hero4 = new TSprite(spcvs, SpriteInfoList.sonic5, 500, 250);


    //Functions

    //GPU-en kjører animasjonen
    //CPU-en kjører logikken slik at sonic kan flytte seg

    // Funksjon som tegner på canvas
  function drawCanvas() {
    // This is a high performance function
    // Do not do any heavy calculations here

    hero.draw(); //Tegner helten
    hero2.draw(); //Tegner den andre helten
    hero4.draw();
  }

  let direction = 1; //1 betyr at sonic beveger seg mot høyre, -1 betyr at han beveger seg mot venstre

  //Funksjon for å animere helten bortover skjermen
  function animate() {
    hero.x += 3 * direction;                             //Øker x-koordinaten til helten med 1 hver gang funksjonen kalles
    hero2.x += 3 * direction;                            //Øker x-koordinaten til den andre helten med 2 hver gang funksjonen kalles
    if ((hero.x > cvs.width - hero.width) || ( hero.x + hero.width < 0 && direction < 0)){          //Hvis hero sin x-verdi er større enn canvas sin bredde ELLER mindre enn 0... 
      //hero.x = -hero.width;                            //...setter vi hero sin x-verdi til minus helten sin bredde (slik at han kommer inn fra venstre side igjen)
      direction *= -1;                                   //Endrer retning
      hero.flipHorizontal();                             //Speilvender helten horisontalt
      // if (hero.x > cvs.width - hero.width) {
      //   hero.x = cvs.width - hero.width;}
      // Med denne if-en gå sonic til start når han treffer kanten til skjermen
    }
    if ((hero2.x > cvs.width - hero2.width) || ( hero2.x + hero2.width < 0 && direction < 0)){
      hero2.flipHorizontal();                            //Speilvender helten horisontalt
    }
  }


    function sheetLoaded() {
      console.log("Sheet loaded"); //Sender "Sheet loaded" til console
      spcvs.showFramerate = true;  //Viser FPS på skjermen
      spcvs.onDraw = drawCanvas;   //Setter onDraw funksjonen til drawCanvas funksjonen
      hero.animationSpeed = 20;    //Setter animasjonshastigheten til 20
      hero.rotation = 0;           //Roterer helten 0 grader
      //hero.flipHorizontal();       //Speilvender helten horisontalt

      //Starter animasjonen
      setInterval(animate, 20); //Kaller animate funksjonen hvert 20. millisekund
      hero2.animationSpeed = 30;
    
    }

    function onKeyDown(aEvent) {
      switch(aEvent.code){
        case "ArrowUp":
        hero4.y -= 5;
          break;
        case "ArrowRight":
          hero4.x += 5;
          break;
        case "ArrowDown":
          hero4.y += 5
          break;
        case "ArrowLeft":
          hero4.x -= 5;
          break;
      }
    }

    //Main application
    spcvs.loadSpriteImage("sonic_sprite_sheet.png", sheetLoaded);
    document.addEventListener("keydown", onKeyDown);


  </script>
</html>
